# 量化回测的“刻舟求剑”困局：从 ETF 轮动网格搜索到 AI Agent 的进化思考

**作者**: BreadFree 项目主理人
**首发**: 知乎

---

## 引言：95% 胜率的幻觉

做量化的人，大抵都经历过这样一段“蜜月期”：写好一个策略，比如最经典的 ETF 动量轮动，打开网格搜索（Grid Search），让脚本跑一晚上。第二天早上起来一看，哇，某组参数在过去5年跑出了年化 40%、最大回测 10% 的神仙曲线。

那一刻，你觉得你找到了市场的圣杯。

直到你把这套参数放到另一段历史行情，或者实盘跑了两个月。曲线掉头向下，圣杯变成了“剩杯”。

最近我在维护开源项目 **BreadFree**（一个 A 股 AI 量化交易平台）时，针对 ETF 轮动策略（RotationStrategy）做了一组详尽的实验，这种“参数过拟合”的无力感再次袭来。但这次，它给了我一个新的启示，让我更加坚信 AI Agent 才是量化交易的下一站。

## 实验：寻找那个“万能参数”

我们的策略逻辑很简单：在 ETF 池中，选取过去 N 天（Lookback）涨幅最好的 Top N 只标的，持有 M 天（Hold）后再次调仓。

这就涉及三个“超参数”：
1.  **Lookback Period (回溯周期)**
2.  **Hold Period (持仓周期)**
3.  **Top N (持有数量)**

为了找到最优解，我用 DeepSeek 给出的建议：“在较宽的市场周期中搜索到的最优参数更有价值”。于是我设计了一个实验：

*   **训练集**：2021年 - 2025年（包含震荡、阴跌、急拉等多种行情）。
*   **验证集 A**：2020年（典型的结构性牛市）。
*   **验证集 B**：2025年（另一个牛市样本）。

我跑了几十组参数组合，旨在发现最优组合。

### 困惑一：不仅是“抄作业”那么简单

在 **2021-2025** 这 5 年的超长跨度里，网格搜索告诉我的“标准答案”是：
> **Lookback=20, Hold=10, Top=2** -> 总收益 **123.38%**

这组参数看起来无懈可击。按照量化的常识，用长周期训练出的参数泛化性应该更好。

然而，当我把这组“冠军参数”放到 **2020年** 回测时：
> **Lookback=20, Hold=10, Top=2** -> 收益 39.89%

这当然不差，但当年的最优解是：
> **Lookback=20, Hold=15, Top=1** -> 收益 **69.06%**

**你看，Top N 从 2 变成了 1，Hold 从 10 变成了 15，收益差了近一倍。**

### 困惑二：牛市也不尽相同

我又对比了 **2025年**（也是个牛市）：
最优解变成了：
> **Lookback=20, Hold=5, Top=1** -> 收益 **65.92%**

而在 2025 年用 2020 年的“冠军参数”（Hold 15）会怎样？收益直接腰斩到 26%。

### 实验结论：唯一不变的是“20天”

在所有优胜组中，唯有一个参数惊人地一致：**Lookback Period = 20**。

这似乎揭示了 A 股 ETF 某种内在的动量属性——**月线级别的趋势**是最有效的信号源。

但是，**Hold Period（持仓周期）** 和 **Top N（持仓数量）** 却在疯狂跳动。
*   行情极致时（如 2020、2025 主升浪），Top 1 集中持仓 + 短周期调仓（Hold 5）往往不仅进攻性强，防守也快。
*   行情混沌震荡时（如 2021-2025），多持仓（Top 2）+ 适中周期（Hold 10）更能平滑波动。

这就是传统量化的死结：**市场风格（Regime）在变，固定的参数永远是刻舟求剑。** 你不仅要预测涨跌，还要预测“这个时候适合什么样的参数”。

## 破局：从“死参数”到“活 Agent”

这正是我在 **BreadFree** 项目中引入 LangGraph 多智能体架构的初衷。

既然固定的 `Top N` 和 `Hold Period` 无法通过数学统计找到万能解，那我们为什么不让 AI 来动态决定这些参数呢？

在 BreadFree 的架构中，我们不再试图寻找一组固定的“神仙参数”，而是构建了一个**虚拟投委会**：

### 实验的反思

通过回测数据，我们发现 **Lookback=20 (月线动量)** 是一个通过统计学挖掘出的“硬特征”，可以保留作为一种**先验知识（Prior Knowledge）**。

而 **Hold Period** 和 **Top N** 这种与市场微观结构息息相关的参数，不应该写死在代码里（Hard-coded），而应该成为智能体的**Action（动作空间）**。

这就是下一代量化回测系统 BreadFree 正在做的事情：
*   **传统量化**负责计算基础信号（如 20日动量）。
*   **LLM Agent** 负责根据宏观、新闻和盈亏状态，动态调整策略的超参数。

如果你也对这种“传统量化 + AI Agent”的融合模式感兴趣，或者在回测中遇到过同样的参数困惑，欢迎来 **BreadFree** 项目一起交流。让我们不再在网格搜索的迷宫里打转，而是试图去构建一个能像人一样“审时度势”的交易系统。

## 互动与未来计划

上一期大家提到了很多尖锐但也切中要害的问题，非常有启发性，这里统一做一个探讨。

**1. 关于“新闻滞后与真假”**
不少朋友指出：“新闻和研报本质上是滞后的”，而且“消息分不了真假”。这是一个非常痛点的问题。在实盘中，完全依赖公开新闻做决策确实类似于“看着后视镜开车”。
**未来的改进思路**：在没有接入更实时、更一手的高频资讯源之前，我会调整 **Analyst Agent** 的权重。**短期内，市场分析师将更多依据“硬指标”做决策**，例如：
*   **绝对动量**：大势是否向上？
*   **相对动量**：哪个板块在边际走强？
*   **波动率**：当前市场恐慌程度如何？
新闻模块将更多作为辅助验证的角色，或者仅用于捕捉哪怕滞后但影响深远的重磅政策转向。

**2. 关于“数据源稳定性”**
有朋友反馈 AkShare 偶尔会访问超时，建议更换。目前项目作为开源演示，尽量使用了免费公开的数据源。对于稳定性要求更高的场景，架构上是支持替换为 Tushare、BaoStock 甚至本地清洗后的数据库的。如果大家有更好用的免费数据源推荐，欢迎评论留言。

**3. 关于“股市控盘与系统性风险”**
至于“股市控盘”这类更深层的问题，确实很难单纯靠代码解决。但我们在设计 Agent 时，引入风控官角色动态调整 Top N 分散持仓，正是为了在一定程度上通过概率来对抗这种单点黑天鹅。

**最后的一点心里话**
我是一名资深的 Python 开发者，也在 AI 研发领域摸爬滚打过几年，但在量化交易上，我还是个不折不扣的新手。

**BreadFree** 项目更多是我作为一个技术人，对自己想法落地的一次探索与开源实践。如果你有好的想法、数据源推荐或者策略建议，**请务必在评论区提出来**。我会持续将实现的代码开源，供大家参考和魔改。不对的地方，也欢迎随时拍砖指正。


---

*BreadFree 项目地址：[github.com/FeiCoder/BreadFree-Simu](https://github.com/FeiCoder/BreadFree-Simu)*
*本文数据基于 BreadFree 项目 `grid_search.sh` 在 2020-2025 数据集上的真实跑测结果。*
